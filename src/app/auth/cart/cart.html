<div class="container my-5">
  <h2 class="mb-4 fw-bold text-primary"><i class="fas fa-shopping-cart me-2"></i> Giỏ hàng của bạn</h2>

  <div class="input-group mb-4 shadow-sm" style="max-width: 400px;">
    <span class="input-group-text"><i class="fas fa-search"></i></span>
    <input
      type="text"
      class="form-control"
      placeholder="Tìm sản phẩm..."
      [(ngModel)]="searchText"
      (input)="searchCart()"
    />
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th style="width: 5%;">
            <input type="checkbox" [checked]="selectAll" (change)="toggleSelectAll()" class="form-check-input" />
          </th>
          <th style="width: 40%;">Sản phẩm</th>
          <th style="width: 15%;">Giá</th>
          <th style="width: 15%;">Số lượng</th>
          <th style="width: 15%;">Thành tiền</th>
          <th style="width: 10%;">Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of displayedItems; let i = index">
          <td>
            <input
              type="checkbox"
              [(ngModel)]="item.selected"
              (ngModelChange)="toggleSelection(item)"
              class="form-check-input"
            />
          </td>
          <td class="d-flex align-items-center fw-bold">
            <img [src]="item.image_url" alt="{{ item.name }}" class="me-3 rounded" style="width: 60px; height: 40px; object-fit: cover;">
            {{ item.name }}
          </td>
          <td class="text-nowrap">{{ item.price | currency : 'VND' : 'symbol' : '1.0-0' }}</td>
          <td>
            <input
              type="number"
              min="1"
              class="form-control form-control-sm text-center"
              [value]="item.quantity"
              (change)="updateQuantity(item, $event)"
              style="max-width: 70px; margin: auto;"
            />
          </td>
          <td class="text-danger fw-semibold text-nowrap">{{ item.price * item.quantity | currency : 'VND' : 'symbol' : '1.0-0' }}</td>
          <td>
            <button class="btn btn-sm btn-outline-danger" (click)="removeItem(item)">
              <i class="fas fa-trash-alt"></i> Xóa
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="cartItems.length === 0" class="alert alert-info text-center p-4 my-4">
    <i class="fas fa-box-open me-2"></i> Giỏ hàng của bạn đang trống.
  </div>

  <div class="card p-4 shadow-lg mt-4" *ngIf="cartItems.length > 0">
    <h4 class="card-title mb-3"><i class="fas fa-file-invoice me-2"></i> Tóm tắt Giỏ hàng</h4>
    <hr>
    <div class="d-flex justify-content-between mb-2">
      <span class="fw-normal">Tổng số lượng sản phẩm:</span>
      <span class="fw-bold">{{ totalQuantity }}</span>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mb-4 pt-2 border-top">
      <h5 class="m-0">TỔNG TIỀN (Tạm tính):</h5>
      <h5 class="text-danger fw-bold m-0">{{ totalAmount | currency : 'VND' : 'symbol' : '1.0-0' }}</h5>
    </div>
    
    <button (click)="proceedToCheckout()" class="btn btn-primary btn-lg w-100">
      <i class="fas fa-money-check-alt me-1"></i> TIẾN HÀNH THANH TOÁN
    </button>
  </div>
</div>