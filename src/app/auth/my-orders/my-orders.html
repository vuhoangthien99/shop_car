<div class="container my-5">
    <h2 class="mb-4">L·ªãch s·ª≠ ƒê∆°n h√†ng c·ªßa t√¥i üõí</h2>

    <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">ƒêang t·∫£i ƒë∆°n h√†ng...</p>
    </div>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div *ngIf="!isLoading && !error && myOrders.length === 0" class="alert alert-info p-4">
        B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o. H√£y b·∫Øt ƒë·∫ßu mua s·∫Øm!
    </div>

    <div *ngIf="!isLoading && myOrders.length > 0" class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle">
            <thead>
                <tr class="table-primary">
                    <th>M√£ ƒê∆°n</th>
                    <th>Ng√†y ƒë·∫∑t</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let order of myOrders">
                    <td>#{{ order.id }}</td>
                    <td>{{ order.order_date | date:'mediumDate' }}</td>
                    <td class="fw-bold">{{ order.total_amount | currency:'VND' }}</td>
                    <td>
                        <span class="badge fs-6" 
                            [class.bg-warning]="order.status === 'pending'"
                            [class.bg-success]="order.status === 'confirmed' || order.status === 'completed'"
                            [class.bg-danger]="order.status === 'cancelled' || order.status === 'returned'">
                            {{ getStatusLabel(order.status) }}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" (click)="viewOrderDetails(order)">Xem chi ti·∫øt</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div *ngIf="selectedOrder" class="modal-backdrop">
        <div class="modal-content-lg">
            <h4 class="modal-title mb-3">Chi ti·∫øt ƒê∆°n h√†ng #{{ selectedOrder.id }}</h4>
            <div class="p-3 border rounded mb-4 bg-light">
                <p><strong>Ng√†y ƒë·∫∑t:</strong> {{ selectedOrder.order_date | date:'short' }}</p>
                <p><strong>T·ªïng ti·ªÅn:</strong> <span class="text-danger fw-bold">{{ selectedOrder.total_amount | currency:'VND' }}</span></p>
                <p><strong>Tr·∫°ng th√°i:</strong> 
                    <span class="badge fs-6" 
                        [class.bg-warning]="selectedOrder.status === 'pending'"
                        [class.bg-success]="selectedOrder.status === 'confirmed' || selectedOrder.status === 'completed'"
                        [class.bg-danger]="selectedOrder.status === 'cancelled' || selectedOrder.status === 'returned'">
                        {{ getStatusLabel(selectedOrder.status) | uppercase }}
                    </span>
                </p>
            </div>

            <h5 class="mt-4">S·∫£n ph·∫©m</h5>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr class="table-light">
                            <th>·∫¢nh</th>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>Gi√° s·∫£n ph·∫©m</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Th√†nh ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of selectedOrder.details">
                            <td><img [src]="item.image_url" width="50" height="50" style="object-fit: cover;"></td>
                            <td>{{ item.product_name }}</td>
                            <td>{{ item.price_at_order | currency:'VND' }}</td>
                            <td>{{ item.quantity }}</td>
                            <td class="fw-bold">{{ (item.price_at_order * item.quantity) | currency:'VND' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <button class="btn btn-secondary mt-4 w-100" (click)="closeOrderDetails()">ƒê√≥ng</button>
        </div>
    </div>
</div>